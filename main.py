""""
ä»Šæ—¥ã‚‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã¶ã£å£Šã—ã¦ãŠã„ãŸã‚ˆï¼
ğŸ’‹ğŸ’‹ğŸ’‹ğŸ’‹ã¾ãšã¯ç›´ãã†ã­ã€œğŸ’‹ğŸ’‹ğŸ’‹ğŸ’‹


ãã®ï¼ï¼šã¶ã£å£Šã—ãƒ‘ãƒ¼ãƒˆä¿®æ­£
ãã®ï¼‘ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª¬æ˜
ãã®ï¼’ï¼šã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã‚ˆã†ï¼
"""
import pygame
import os
import random

TATE = 900
YOKO = 1200
TITLE = "TAKOYAKI OISHI"
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®šã—ã‚ˆã†ï¼BASE_DIRã¨ã‹ã§ã„ã„ã‚ˆ
BASE_DIR = os.path.dirname(__file__)
# ç”»åƒã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
IMG_DIR = os.path.join(BASE_DIR, "imgs")
# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”»åƒã‚’æŒ‡å®š
PLAYER_DIR = os.path.join(IMG_DIR, "resized_ningen2025.png")
"""
PART01
"""
# ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
# ã“ã“ã«ã¯ç”»åƒã®åå‰ã‚’æŒ‡å®šï¼
#SPRITESHEET_DIR = os.path.join(IMG_DIR, "")

# ã‚¹ãƒ†ãƒƒãƒ—ï¼“
# è‰²ã€…ã¨åˆæœŸåŒ–ã‚’ã—ã‚ˆã†
# åˆæœŸåŒ–ã£ã¦ä½•ï¼Ÿ
# ç­”ãˆï¼šã¤ã‹ãˆã‚‹ã˜ã‚‡ã†ãŸã„ã«ã™ã‚‹ã“ã¨
# pygameã‚’åˆæœŸåŒ–
# pygame.init()ã§åˆæœŸåŒ–ã§ãã‚‹ã‚ˆã€‚è¦šãˆãªãã¦ã„ã„ï¼
pygame.init()
# ã‚²ãƒ¼ãƒ ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã‚’åˆæœŸåŒ–
# pygame.display.set_mode((ã‚ˆã“ã¯ã°,ãŸã¦ã¯ã°))ã§ä½œã‚Œã‚‹ã‚ˆã€‚è¦šãˆãªãã¦ã„ã„ã‚ˆï¼
screen = pygame.display.set_mode((YOKO, TATE))

# ã‚¹ãƒ†ãƒƒãƒ—ï¼•ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œã‚ã†
class Player(pygame.sprite.Sprite):
    def __init__(self):
        """
        ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
        Args:
            width (int): ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”»åƒã®å¹…ã€‚
            height (int): ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”»åƒã®é«˜ã•ã€‚
        ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤–è¦³ã€ä½ç½®ã€ãŠã‚ˆã³ä»–ã®å±æ€§ã‚’è¨­å®šã—ã¾ã™ã€‚
        ã“ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹éš›ã«è‡ªå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã€
        ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸè¨­å®šã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
        """
        # è¦ªã‚¯ãƒ©ã‚¹(Sprite)ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å®Ÿè¡Œ
        pygame.sprite.Sprite.__init__(self)
        """
        PART02
        """
        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç”¨æ„
        # Surfaceï¼ˆç”»åƒã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚¯ãƒ©ã‚¹ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦å¤‰æ•°ã«ä¿å­˜ï¼ˆåˆæœŸåŒ–ï¼‰
        self.image = pygame.Surface((32, 32))
        # ç”»åƒã®ã‚µã‚¤ã‚ºã¨åŒã˜ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ç”¨æ„
        """
        PART03
        """
        # ä½¿ã†ç”»åƒã®ãƒ‘ã‚¹ã‚’å–å¾—ã€‚
        # pygame.image.load(SPRITESHEET_DIR).convert()ã§ãƒ‘ã‚¹ã‚’å–å¾—ã§ãã‚‹
        # ãã‚Œã‚’å¤‰æ•°ã«ä¿å­˜ã€‚ã‚¯ãƒ©ã‚¹å†…ã®å¤‰æ•°ã ã‚ˆï¼
        self.gazou = pygame.image.load(PLAYER_DIR).convert()
        """
        PART04
        """
        # ä½œæˆã—ãŸã‚­ãƒ£ãƒ³ãƒã‚¹(self.image)ã«ä½¿ã†ç”»åƒã‚’ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆã‹ã‚‰æŒ‡å®šã—ã¦è²¼ã‚Šä»˜ã‘
        # self.image.blit(#ä½¿ã†ç”»åƒã®ãƒ‘ã‚¹, (0, 0), (0, 0, æ¨ªå¹…, ç¸¦å¹…))
        # ç¬¬ï¼“å¼•æ•°ã®ï¼“ç•ªç›®ã¨ï¼”ç•ªç›®ã®å€¤ã‚’ç”»åƒã®ã‚µã‚¤ã‚ºã«å¤‰æ›´ï¼
        self.image.blit(self.gazou, (0,0),(0,0,32,32))
        """
        PART05
        èƒŒæ™¯è‰²ã‚’é€æ˜ã«ã™ã‚‹
        """
        # é€æ˜ã«ã™ã‚‹è‰²ã‚’æŒ‡å®šã€‚self.image.get_at((0, 0))ã¨ã—ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹ã®å·¦ä¸Šã®è‰²ã‚’å–å¾—
        # å–å¾—ã—ãŸã„ã‚ã‚’å¤‰æ•°ã«ä¿å­˜ã€‚ã“ã‚Œã¯selfãªãã¦ã„ã„ã€‚ã§ã‚‚ã‚ã£ã¦ã‚‚ã„ã‘ã‚‹ã€‚
        iro = self.image.get_at((0,0))
        # ç”»åƒã®èƒŒæ™¯è‰²ã‚’é€éã™ã‚‹ã€‚
        # ä¸Šã§å–å¾—ã—ãŸè‰²ã‚’ä½¿ã£ã¦èƒŒæ™¯è‰²ã‚’é€æ˜ã«ã™ã‚‹
        # ã‚­ãƒ£ãƒ³ãƒã‚¹å.set_colorkey(ä¸Šã§å–å¾—ã—ãŸè‰²)
        self.image.set_colorkey(iro)
        """
        PART06
        ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’èª¿æ•´
        """
        # ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹åã«å†åº¦ä¿å­˜ã€‚
        # ã‚­ãƒ£ãƒ³ãƒã‚¹å = pygame.transform.scale(ã‚­ãƒ£ãƒ³ãƒã‚¹å, (ãƒªã‚µã‚¤ã‚ºã—ãŸã„æ¨ªå¹…, ãƒªã‚µã‚¤ã‚ºã—ãŸã„ç¸¦å¹…))
        
        # ç”»åƒã®ä½ç½®ã‚’å–å¾—ã€‚Rectå‹ç¯„å›²ã¯å¸¸ã«(0,0)åº§æ¨™ã‚’èµ·ç‚¹ã¨ã—ã¦ã‚‹
        self.rect = self.image.get_rect()
        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®xåº§æ¨™ã‚’è¨­å®š
        self.rect.x = 100
        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®yåº§æ¨™ã‚’è¨­å®š
        self.rect.y = 100
        # æ¨ªç§»å‹•ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
        self.vx = 0
        # ç¸¦ç§»å‹•ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
        self.vy = 0

    def update(self):
        keys = pygame.key.get_pressed()
        if keys[pygame.K_RIGHT] == True:
            self.vx = -1
        elif keys[pygame.K_LEFT] == True:
            self.vx = 1
        elif keys[pygame.K_UP] == True:
            self.vy = 1
        elif keys[pygame.K_DOWN] == True:
            self.vy = -1
        else:
            self.vx = 0
            self.vy = 0
        self.rect.x += self.vx
        self.rect.y += self.vy

"""
ã¦ãã‚’ä½œã‚ã†ï¼
æ•µã¯ã¨ã‚Šã¾ã‚·ãƒ³ãƒ—ãƒ«ã«ç§»å‹•ã™ã‚‹ã ã‘ã§ã„ã„
STEP01
"""
class Teki(pygame.sprite.Sprite):
    def __init__(self):
        # è¦ªã‚¯ãƒ©ã‚¹(Sprite)ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å®Ÿè¡Œ
        pygame.sprite.Sprite.__init__(self)
        self.image = pygame.Surface((32, 32))
        """
        æ•µã®ç”»åƒã‚’å¤‰æ›´ã—ã‚ˆã†ï¼
        """
        self.gazou = pygame.image.load(PLAYER_DIR).convert()
        # ä½œæˆã—ãŸã‚­ãƒ£ãƒ³ãƒã‚¹(self.image)ã«ä½¿ã†ç”»åƒã‚’ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚·ãƒ¼ãƒˆã‹ã‚‰æŒ‡å®šã—ã¦è²¼ã‚Šä»˜ã‘
        # self.image.blit(#ä½¿ã†ç”»åƒã®ãƒ‘ã‚¹, (0, 0), (0, 0, æ¨ªå¹…, ç¸¦å¹…))
        # ç¬¬ï¼“å¼•æ•°ã®ï¼“ç•ªç›®ã¨ï¼”ç•ªç›®ã®å€¤ã‚’ç”»åƒã®ã‚µã‚¤ã‚ºã«å¤‰æ›´ï¼
        self.image.blit(self.gazou, (0, 0), (0, 0, 32, 32))
        # ç”»åƒã®ä½ç½®ã‚’å–å¾—ã€‚Rectå‹ç¯„å›²ã¯å¸¸ã«(0,0)åº§æ¨™ã‚’èµ·ç‚¹ã¨ã—ã¦ã‚‹
        self.rect = self.image.get_rect()

        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®xåº§æ¨™ã‚’è¨­å®š
        self.rect.x = 10
        # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®yåº§æ¨™ã‚’è¨­å®š
        self.rect.y = random.randint(0, 300)
        # æ¨ªç§»å‹•ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
        self.vx = 1
        # ç¸¦ç§»å‹•ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
        self.vy = 0

    def update(self):
        self.rect.x += self.vx



player = Player()
"""
STEP02
æ•µã‚’åˆæœŸåŒ–ã—ã‚ˆã†ï¼
"""

all_sprites = pygame.sprite.Group()
# ã“ã®ã¯ã“ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…¥ã‚Œã‚‹
all_sprites.add(player)


# æ•µã‚’ã—ã¾ã†ç®±
teki_hako = pygame.sprite.Group()

"""
STEP03
ãŸã ã—ã€ã¿ã¦ã‚‹ã ã‘
æ•µãŒå‡ºã¦ãã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ±ºã‚ã‚ˆã†ï¼
"""
# æ•µãŒå‡ºã¦ãã‚‹é–“éš”ã‚’æ±ºã‚ã‚‹ï¼ˆç§’ï¼‰
teki_detekuru_kankaku = 0

# æœ€å¾Œã«æ•µã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰ã®çµŒéæ™‚é–“ã‚’è¿½è·¡ã™ã‚‹å¤‰æ•°
saigo_teki_detekara_keika_jikan = 0


kurikaeshi = True
while kurikaeshi:
    # ç¾åœ¨ã®æ™‚é–“ã‚’å–å¾—ã€‚pygame.time.get_ticks() / 1000ã‚’ä½¿ã†ã¨ã§ãã‚‹ã‚ˆï¼
    current_time = pygame.time.get_ticks() / 1000  # ãƒŸãƒªç§’ã‚’ç§’ã«å¤‰æ›
    # ã“ã“ã¯ã¡ã‚‡ã£ã¨ã§ã‚€ãšã„ã®ã§èª¬æ˜ã—ã¾ã™(for_loop.py)ã‚’ã¿ã‚ˆã†ï¼
    for event in pygame.event.get():
        # ã‚‚ã—ã‚‚èµ¤ãƒãƒ„ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰(pygame.QUIT)ç¹°ã‚Šè¿”ã—ã‚’çµ‚äº†ã™ã‚‹
        if event.type == pygame.QUIT:
            # ç¹°ã‚Šè¿”ã—ã‚’çµ‚äº†ã™ã‚‹
            kurikaeshi = False
        #print(f"Enemy spawned at {current_time} seconds")  # æ•µãŒç”Ÿæˆã•ã‚ŒãŸæ™‚åˆ»ã‚’å‡ºåŠ›
    """
    STEP04
    æ•µãŒå‡ºã¦ãã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ±ºã‚ã‚ˆã†ï¼
    random.randintã§ã‚‚ã„ã„ã—ã€ã‚‚ã£ã¨ç´°ã‹ã(0.2ç§’ã¨ã‹)è¨­å®šã—ãŸã„ãªã‚‰random.uniformã¨ã‹ã‚‚ã‚ã‚Šï¼
    """
    teki_detekuru_kankaku = 0.2
    if current_time - saigo_teki_detekara_keika_jikan > teki_detekuru_kankaku:
        """
        ã‚„ã‚‹ã“ã¨
        ãã®ï¼‘ï¼šæ™‚é–“ãŒçµŒã£ãŸã‚‰æ•µã‚’ä½œæˆ(åˆæœŸåŒ–) ãƒ’ãƒ³ãƒˆ player = Player()
        ãã®ï¼’ï¼šæ•µã‚’ã‚²ãƒ¼ãƒ ä¸Šã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç®¡ç†ã™ã‚‹ç®±ã«ã—ã¾ã† ãƒ’ãƒ³ãƒˆ all_sprites.add(player)
        ãã®ï¼“ï¼šsaigo_teki_detekara_keika_jikanã‚’current_timeã§æ›´æ–° ãƒ’ãƒ³ãƒˆ ãã‚“ãªã‚‚ã‚“ãªã„ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚ã‚ï¼ï¼
        """
        teki = Teki()
        teki_hako.add(teki)
        saigo_teki_detekara_keika_jikan = current_time
    """
    å•é¡Œï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ•µã«ã¶ã¤ã‹ã£ãŸã‚’åˆ¤å®šã—ã‚ˆã†
    pygame.sprite.spritecollide(sprite=ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ group=æ•µã‚’ç®¡ç†ã™ã‚‹ç®±, dokill=False)
    â€» ç§ãŒæ³¨æ„ï¼ä¸Šè¨˜ã®é–¢æ•°ã§Trueã¾ãŸã¯Falseã„ãšã‚Œã‹ãŒå…¥ã‚‹
    â€» ç§ã«ãƒ’ãƒ³ãƒˆï¼šTrueãªã‚‰çµ‚ã‚ã‚‰ã›ã‚‹ã ã‘ã•ğŸ’‹
    â€» ç§ãŒæ³¨æ„ï¼spriteã«ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™ã“ã¨ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ã§ã¯ãªã„ã€‚
    â€» æ•µã ã‘ã‚’ç®¡ç†ã™ã‚‹ç®±ãŒãªã„ã¨
    """
    pygame.sprite.spritecollide(player,teki_hako,dokill=True)
    # ã§ã‘ãŸï¼ŸãŠã‘ï¼Ÿ
    # èƒŒæ™¯ã‚’çœŸã£é»’ã«å¡—ã‚Šã¤ã¶ã™
    screen.fill((0, 0, 0))
    # æ˜Ÿã‚’æç”»ã™ã‚‹ï¼ˆä¾‹ãˆã°ã€100å€‹ã®æ˜Ÿï¼‰
    all_sprites.update()
    all_sprites.draw(screen)
    teki_hako.update()
    teki_hako.draw(screen)
    pygame.display.flip()
pygame.quit()
